Con un Entity nosotros tenemos que realizar unas operaciones sobre el (insertar, consultar, etc...)

## **PATRON DAO (Data Access Object):**

Vamos a definir una clase que contenga todos los m√©todos para acceder a la BBDD.
Las consultas solo van a ir en los metodos DAO.

## **PATRON SINGLETON**

El objeto solo se crea una vez y se crea la sesion solo una vez (aunque tengamos en el hibernate.cfg.xml aqui CREATE: <property name="hibernate.hbm2ddl.auto">CREATE</property> , no borrara ni hara de nuevo las tablas)

Algo muy comun es buscar algo por su primary key. sI POR EJEMPLO NUESTRA primary KEY en una tabla fuese de tipo long, seria as√≠:

return ()

## **SEQUENCE**
Se trabaja mas con **Identity** pero Sequence tambien se sigue usando
Identity es algo especifico para una tabla y secuencia se puede usar en cualquier tabla
Sequence tambien es autoincremental

Las anotaciones de hibernate son las que empiezan por @Column, y el resto (por ejemplo @NotNull, @NotBlank, etc....son validaciones de la BBDD)
![[Pasted image 20251126193802.png]]

![[Pasted image 20251126193926.png]]

---

27/11/2025

## **CRUD**
üìå ¬øQu√© significa CRUD?

CRUD es un acr√≥nimo muy usado en programaci√≥n y bases de datos. Representa las **cuatro operaciones b√°sicas** que se pueden realizar sobre la informaci√≥n:

- **C ‚Äì Crear (Create):** a√±adir nuevos registros.
- **R ‚Äì Leer (Read):** consultar o visualizar registros existentes.
- **U ‚Äì Actualizar (Update):** modificar datos ya guardados.
- **D ‚Äì Borrar (Delete):** eliminar registros.

üñ•Ô∏è Ejemplo pr√°ctico: Imagina una aplicaci√≥n de notas:

- **Crear:** escribir una nueva nota.
- **Leer:** abrir y ver las notas guardadas.
- **Actualizar:** editar el contenido de una nota.
- **Borrar:** eliminar una nota que ya no necesitas.

üåê Relaci√≥n con APIs REST. En el desarrollo web, CRUD se relaciona directamente con los m√©todos HTTP:

- **POST ‚Üí Crear**
- **GET ‚Üí Leer**
- **PUT/PATCH ‚Üí Actualizar**
- **DELETE ‚Üí Borrar**

---

En **HQL (Hibernate Query Language)**, cuando escribes una cl√°usula `WHERE`, los valores que usas se refieren a **atributos de las clases Java mapeadas**, no directamente a las columnas de la base de datos.

# **PATRON DTO (Data Transport Object**)

Va de la capa de BBDD a la capa de Servicios, es una clase donde se meten los atributos que queramos transportar.

Es  buena idea organizarlo en paquetes:
- Paquete DAO
- Paquete CTO
- Paquetes Entitys
- Paquete de presentaci√≥n

üì¶ Organizaci√≥n por paquetes

- **DAO (Data Access Object)**

- Contiene las clases e interfaces que interact√∫an directamente con la base de datos.
- Encapsulan la l√≥gica de acceso a datos (consultas, inserciones, actualizaciones).
- Ejemplo: `ClienteDAO`, `ProductoDAO`.

- **CTO (Controller Transfer Object / Core Transfer Object)**

- Aqu√≠ se definen los DTOs, que son objetos planos (POJOs) usados para transportar datos entre capas.
- No contienen l√≥gica de negocio, solo atributos y getters/setters.
- Ejemplo: `ClienteDTO`, `PedidoDTO`.

- **Entities (Entidades)**

- Representan las tablas de la base de datos en forma de objetos.
- Suelen estar anotadas con frameworks ORM (Hibernate, JPA).
- Ejemplo: `ClienteEntity`, `ProductoEntity`.

- **Presentaci√≥n (UI o capa de vista)**

- Maneja la interacci√≥n con el usuario (web, m√≥vil, escritorio).
- Consume los servicios y muestra la informaci√≥n proveniente de los DTOs.
- Ejemplo: `ClienteController`, `PedidoView`.


‚úÖ Buenas pr√°cticas

- Mantener DTOs separados de Entities para evitar exponer directamente la estructura de la base de datos.
- Usar **mappers** (manuales o librer√≠as como MapStruct) para convertir entre Entity ‚Üî DTO.
- Los DAO deben ser lo m√°s simples posible, delegando la l√≥gica de negocio a los servicios.
- La capa de presentaci√≥n nunca deber√≠a acceder directamente a Entities ni DAOs, solo a DTOs y servicios.
---
De la capa de presentacion a la capa de servicio ‚Üí DTO
De la capa de servicio a la capa de datos ‚Üí DAO y Entitys

üìê Flujo entre capas

- **Capa de presentaci√≥n ‚Üí Capa de servicio**

- Aqu√≠ se utilizan **DTO (Data Transfer Objects)**.
- La presentaci√≥n nunca deber√≠a trabajar directamente con entidades de base de datos.
- Los DTO sirven para transportar datos de forma segura y desacoplada.
- Ejemplo: un formulario web env√≠a datos ‚Üí se convierten en un `UsuarioDTO` ‚Üí el servicio los procesa.

- **Capa de servicio ‚Üí Capa de datos**

- Aqu√≠ entran en juego los **DAO (Data Access Objects)** y las **Entities**.
- El servicio transforma el DTO en una **Entity** (objeto persistente) y lo pasa al DAO.
- El **DAO** se encarga de interactuar con la base de datos (insertar, actualizar, consultar).
- Ejemplo: `UsuarioService` recibe un `UsuarioDTO`, lo convierte en `UsuarioEntity` y llama a `UsuarioDAO.save(entity)`.

üîÑ Ejemplo simplificado en Java
```java
// DTO
public class UsuarioDTO {
   private String nombre;
   private String email;
   // getters y setters
}

// Entity
@Entity
public class UsuarioEntity {
   @Id
   private Long id;
   private String nombre;
   private String email;
   // getters y setters
}

// DAO
public interface UsuarioDAO extends JpaRepository<UsuarioEntity, Long> {}

// Service
@Service
public class UsuarioService {
    @Autowired
    private UsuarioDAO usuarioDAO;

    public void crearUsuario(UsuarioDTO dto) {
       UsuarioEntity entity = new UsuarioEntity();
       entity.setNombre(dto.getNombre());
       entity.setEmail(dto.getEmail());
       usuarioDAO.save(entity);
    }
}
```
‚úÖ Buenas pr√°cticas

- **Separar DTO y Entity**: evita exponer directamente la estructura de la base de datos.
- **Usar mappers**: librer√≠as como **MapStruct** o manualmente para convertir DTO ‚Üî Entity.
- **DAO solo para persistencia**: la l√≥gica de negocio debe estar en la capa de servicio.
- **Presentaci√≥n solo con DTOs**: nunca con Entities ni DAOs.
---
